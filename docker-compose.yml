services:
  # ─────────────────────────────────────────────
  # PicoClaw Agent (one-shot query)
  #   docker compose run --rm picoclaw-agent -m "Hello"
  # ─────────────────────────────────────────────
  picoclaw-agent:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: picoclaw-agent
    profiles:
      - agent
    # Uncomment to access host network; leave commented unless needed.
    #extra_hosts:
    #  - "host.docker.internal:host-gateway"
    volumes:
      - ./config/config.json:/home/picoclaw/.picoclaw/config.json:ro
      - ./.dave:/home/picoclaw/.picoclaw/workspace
      - ./mcp:/mcp:ro
    entrypoint: ["picoclaw", "agent"]
    stdin_open: true
    tty: true

  # ─────────────────────────────────────────────
  # PicoClaw Gateway (Dave)
  #   docker compose up picoclaw-gateway-dave
  # ─────────────────────────────────────────────
  picoclaw-gateway-dave:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: picoclaw-gateway-dave
    restart: unless-stopped
    env_file:
      - .env
    profiles:
      - gateway
    # Uncomment to access host network; leave commented unless needed.
    #extra_hosts:
    #  - "host.docker.internal:host-gateway"
    volumes:
      # Configuration file
      - ./config/config.json:/home/picoclaw/.picoclaw/config.json:ro
      - ./.dave:/home/picoclaw/.picoclaw/workspace:rw
      # MCP server files
      - ./mcp:/mcp:ro
    command: ["gateway"]
    environment:
      - TZ=America/Chicago

  # ─────────────────────────────────────────────
  # PicoClaw Gateway (Jackie)
  #   docker compose up picoclaw-gateway-jackie
  # ─────────────────────────────────────────────
  picoclaw-gateway-jackie:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: picoclaw-gateway-jackie
    restart: unless-stopped
    env_file:
      - .env
    profiles:
      - gateway
    # Uncomment to access host network; leave commented unless needed.
    #extra_hosts:
    #  - "host.docker.internal:host-gateway"
    volumes:
      # Configuration file
      - ./config/config.json:/home/picoclaw/.picoclaw/config.json:ro
      - ./.jackie:/home/picoclaw/.picoclaw/workspace:rw
      # MCP server files
      - ./mcp:/mcp:ro
    command: ["gateway"]
    environment:
      - TZ=America/Chicago

  # ─────────────────────────────────────────────
  # Orchestrator (MCP Server)
  #   docker compose up picoclaw-orchestrator
  # ─────────────────────────────────────────────
  picoclaw-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile.orchestrator
    container_name: picoclaw-orchestrator
    restart: unless-stopped
    profiles:
      - gateway
    volumes:
      - orchestrator-data:/data
    environment:
      - TZ=America/Chicago

  # ─────────────────────────────────────────────
  # Prometheus (Monitoring)
  #   docker compose up prometheus
  # ─────────────────────────────────────────────
  prometheus:
    image: prom/prometheus:v2.53.0
    profiles: [gateway]
    restart: unless-stopped
    volumes:
      - ./config/prometheus.yml:/etc/prometheus/prometheus.yml:ro
      - prometheus-data:/prometheus
    ports:
      - "9090:9090"

  grafana:
    image: grafana/grafana:11.1.0
    profiles: [gateway]
    restart: unless-stopped
    volumes:
      - grafana-data:/var/lib/grafana
      - ./config/grafana/provisioning:/etc/grafana/provisioning:ro
      - ./config/grafana/dashboards:/var/lib/grafana/dashboards:ro
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=picoclaw
      - GF_AUTH_ANONYMOUS_ENABLED=true
      - GF_AUTH_ANONYMOUS_ORG_ROLE=Viewer

volumes:
  orchestrator-data:
  prometheus-data:
  grafana-data:
